<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>PRODUTOS</title>
</head>

<body>
  <div class="container">
    <h1>Cadastro de Produtos</h1></br>

    <form id="produtoForm">
      <label for="nome"><b>Nome</b></label>
      <input type="text" id="nome" name="nome" placeholder="Nome do Produto" required></br></br>

      <label for="categoria"><b>Categoria</b></label>
      <input type="text" id="categoria" name="categoria" placeholder="Categoria do Produto"></br></br>

      <label for="preco"><b>Preço (R$)</b></label>
      <input type="number" id="preco" name="preco" placeholder="Preço (R$)" step="0.01" required></br></br>

      <label for="desconto"><b>Desconto (%)</b></label>
      <input type="number" id="desconto" name="desconto" placeholder="Desconto (%)" step="0.01" required></br></br>

      <button type="submit"><b>Cadastrar</b></button></br></br>
    </form>

    <span>
      <h1>Lista de Produtos Cadastrados</h1></br>
      <ol id="listaProdutos"></ol></br>
    </span>
  </div>

  <script>
    class Produto {
      constructor(nome, categoria, preco, desconto) {
        this.nome = nome;
        this.categoria = categoria;
        this.preco = preco;
        this.desconto = desconto;
      }
      calcularPrecoComDesconto() {
        return this.preco - (this.preco * (this.desconto / 100));
      }
    }

    const form = document.getElementById('produtoForm');
    const listaProdutos = document.getElementById('listaProdutos');

    form.addEventListener('submit', function (event) {
      event.preventDefault();

      const nome = document.getElementById('nome').value.trim();
      const categoria = document.getElementById('categoria').value.trim();
      const preco = parseFloat(document.getElementById('preco').value);
      const desconto = parseFloat(document.getElementById('desconto').value);

      // validações simples
      if (!nome) {
        alert('Informe o nome do produto.');
        return;
      }
      if (isNaN(preco) || preco <= 0) {
        alert('Informe um preço válido (> 0).');
        return;
      }
      if (isNaN(desconto) || desconto < 0) {
        alert('Informe um desconto válido (>= 0).');
        return;
      }

      const produto = new Produto(nome, categoria, preco, desconto);
      adicionarProdutoNaLista(produto);

      form.reset();
      document.getElementById('nome').focus();
    });

    function adicionarProdutoNaLista(produto) {
      const li = document.createElement('li');

      li.innerHTML = `
          <strong>${escapeHtml(produto.nome)}</strong>
          ${produto.categoria ? `<span class="categoria"> — ${escapeHtml(produto.categoria)}</span>` : ''}
          <div class="precos">
            Preço: R$ ${produto.preco.toFixed(2)} |
            Desconto: ${produto.desconto}% |
            Final: R$ ${produto.calcularPrecoComDesconto().toFixed(2)}
          </div>
        
      `;

      const btnRemover = document.createElement('button');
      btnRemover.type = 'button';
      btnRemover.textContent = 'Remover';
      btnRemover.className = 'button';
      btnRemover.addEventListener('click', () => li.remove());

      // botões à direita
      const controls = document.createElement('div');
      controls.className = 'controls';
      controls.appendChild(btnRemover);

      li.appendChild(controls);
      listaProdutos.appendChild(li);
    }

    // evita injeção básica
    function escapeHtml(text) {
      return String(text)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
  </script>
</body>

</html>